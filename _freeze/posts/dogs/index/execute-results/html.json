{
  "hash": "197b54a75b4520f033ec9891fc944ef5",
  "result": {
    "engine": "knitr",
    "markdown": "---\nexecute:\n  message: false\n  warning: false\n  fig-show: no\ntitle: \"Refugio de animales de Long Beach\"\nauthor: \"FV\"\ndate: \"2025-09-14\"\ncategories: [code, analysis]\nimage: \"dogs.png\"\n---\n\n\n\nWorld's tallest towers (Top 6)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load packages -----------------------------------------------------------\n\nlibrary(tidyverse)\nlibrary(showtext)\nlibrary(camcorder)\nlibrary(ggtext)\nlibrary(glue)\nlibrary(tsibble)\n\n\n# Load data ---------------------------------------------------------------\n\ntuesdata <- tidytuesdayR::tt_load(\"2025-03-04\")\nlongbeach <- tuesdata$longbeach\n\n\n# Load fonts --------------------------------------------------------------\n\nfont_add_google(\"Montserrat\")\nshowtext_auto()\nshowtext_opts(dpi = 300)\n\n\n# Define colours and fonts-------------------------------------------------\n\nbg_col <- \"#E3DBDB\"\ntext_col <- \"#2E2424\"\nhighlight_col <- \"#439A86\"\n\nbody_font <- \"Montserrat\"\n\n\n# Data wrangling ----------------------------------------------------------\n\nplot_data <- longbeach |>\n  filter(intake_type == \"owner surrender\", animal_type == \"dog\") |>\n  count(intake_date) |>\n  tsibble::as_tsibble(index = intake_date) |>\n  tsibble::fill_gaps(\n    n = 0,\n    .start = ymd(\"20170101\"),\n    .end = ymd(\"20241231\")\n  ) |>\n  as_tibble()\n\nyear_data <- plot_data |>\n  mutate(year = year(intake_date)) |>\n  group_by(year) |>\n  summarise(n = sum(n)) |>\n  mutate(\n    start = ymd(paste0(year, \"-01-01\")),\n    end = ymd(paste0(year + 1, \"-01-01\")),\n    mid = ymd(paste0(year, \"-07-02\"))\n  )\n\n\n# Annotation function -----------------------------------------------------\n\ntextbox <- function(x, y, label, ...) {\n  geom_textbox(\n    data = data.frame(x = x, y = y, label = label),\n    mapping = aes(\n      x = x, y = y,\n      label = label\n    ),\n    halign = 0.5,\n    hjust = 0.5,\n    size = 3,\n    colour = text_col,\n    fill = alpha(bg_col, 0.4),\n    box.colour = \"transparent\",\n    lineheight = 0.6,\n    ...\n  )\n}\n\ncurved_arrow <- function(x_start, x_end, y_start, y_end, ...) {\n  annotate(\n    geom = \"curve\",\n    x = x_start,\n    xend = x_end,\n    y = y_start,\n    yend = y_end,\n    linewidth = 0.3,\n    color = text_col,\n    arrow = arrow(\n      length = unit(1.5, \"mm\"), type = \"closed\"\n    ),\n    ...\n  )\n}\n\n# Start recording ---------------------------------------------------------\n\ngg_record(\n  dir = file.path(\"2025\", \"2025-03-04\", \"recording\"),\n  device = \"png\",\n  width = 7,\n  height = 5.5,\n  units = \"in\",\n  dpi = 300\n)\n\n\n# Define text -------------------------------------------------------------\n\n\n\n\n\ntitle <- \"Refugio de animales de Long Beach - ¿Cuándo entregan los propietarios a sus perros?\"\nst <- \"Los Servicios de Cuidado Animal de Long Beach (LBACS) atienden a aproximadamente 4000 animales al año, siendo los gatos y los perros los más comunes. Sin embargo, también cuidan de anfibios, cobayas y ganado si es necesario. Además de ser entregados por sus propietarios, los animales pueden llegar a los LBACS como animales callejeros, confiscados o devueltos tras haber sido adoptados.\"\ncap <- paste0(\n  \"**Data**: City of Long Beach Animal Care Services<br>**Graphic**:\", \"\"\n)\n\n\n# Plot --------------------------------------------------------------------\n\np <- ggplot() +\n  geom_rect(\n    data = year_data,\n    mapping = aes(\n      xmin = start,\n      xmax = end,\n      ymin = 0,\n      ymax = 12,\n      fill = n\n    )\n  ) +\n  geom_segment(\n    data = plot_data,\n    mapping = aes(\n      x = intake_date,\n      y = 0,\n      yend = n\n    ),\n    colour = text_col,\n    linewidth = 0.2\n  ) +\n  geom_point(\n    data = filter(plot_data, n > 0),\n    mapping = aes(\n      x = intake_date,\n      y = n\n    ),\n    colour = text_col,\n    size = 0.6\n  ) +\n  geom_textbox(\n    data = year_data,\n    mapping = aes(\n      x = mid,\n      y = 11,\n      label = glue(\"**{year}**<br><span style='font-size: 8pt;'>{n} dogs</span>\")\n    ),\n    halign = 0.5,\n    hjust = 0.5,\n    size = 4,\n    colour = text_col,\n    fill = alpha(bg_col, 0.4),\n    box.colour = \"transparent\",\n    width = 0.1,\n    lineheight = 0.6,\n    minwidth = 0.1,\n    maxwidth = 0.1\n  ) +\n  # annotations\n  textbox(\n    x = ymd(\"20181231\"), y = 8,\n    label = \"El 6 de noviembre de 2017, se entregaron 10 perros. Solo 6 tenían un nombre registrado.\", width = 0.2\n  ) +\n  textbox(\n    x = ymd(\"20220131\"), y = 8.5,\n    label = \"Otro lunes, el 29 de mayo de 2023, se entregaron otros 10 perros. De los 10, 7 eran cachorros con bajo peso.\", width = 0.2\n  ) +\n  textbox(\n    x = ymd(\"20201101\"), y = 5.7,\n    label = \"Durante la pandemia de COVID-19 se entregaron menos perros, posiblemente debido a los confinamientos y al teletrabajo.\", width = 0.22\n  ) +\n  # arrows\n  curved_arrow(ymd(\"20180621\"), ymd(\"20180201\"), 9.2, 9.9, curvature = 0.5) +\n  curved_arrow(ymd(\"20221201\"), ymd(\"20230501\"), 9.3, 9.8, curvature = -0.5) +\n  curved_arrow(ymd(\"20201101\"), ymd(\"20210201\"), 4, 3.5, curvature = 0.5) +\n  # styling\n  scale_y_continuous(\n    breaks = seq(0, 12, by = 2)\n  ) +\n  scale_fill_gradientn(\n    colours = c(\"#9CD3C6\", \"#439A86\", \"#337162\")\n  ) +\n  labs(\n    x = \"\",\n    y = \"Number of dogs surrendered (daily count)\",\n    title = title,\n    subtitle = st,\n    caption = cap\n  ) +\n  coord_cartesian(expand = FALSE, clip = \"off\") +\n  theme_minimal(base_family = body_font, base_size = 10) +\n  theme(\n    legend.position = \"none\",\n    plot.margin = margin(5, 10, 5, 10),\n    plot.title.position = \"plot\",\n    plot.caption.position = \"plot\",\n    plot.background = element_rect(fill = bg_col, colour = bg_col),\n    panel.background = element_rect(fill = bg_col, colour = bg_col),\n    axis.text.x = element_blank(),\n    plot.title = element_textbox_simple(\n      colour = text_col,\n      hjust = 0,\n      halign = 0,\n      margin = margin(b = 5, t = 5),\n      lineheight = 0.5,\n      family = body_font,\n      face = \"bold\",\n      size = rel(1.8)\n    ),\n    plot.subtitle = element_textbox_simple(\n      colour = text_col,\n      hjust = 0,\n      halign = 0,\n      margin = margin(b = 5, t = 0),\n      lineheight = 0.5,\n      family = body_font\n    ),\n    plot.caption = element_textbox_simple(\n      colour = text_col,\n      hjust = 0,\n      halign = 0,\n      margin = margin(b = 5, t = 5),\n      lineheight = 0.5,\n      family = body_font\n    )\n  )\n\np\n```\n:::\n\n\n\n![](dogs.png)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}