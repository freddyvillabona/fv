map <- read_sf('Municipios_Venezuela.shp')
t <- webpage %>%
html_nodes(".mw-parser-output") %>%
html_table()
t <- t[[1]]
variables <- c("N", "MUNICIPIO", "Capital", "ESTADO", "Total", "Cap", "Superficie", "Densidad")
names(t) = c(variables)
t <- t[-(1:28),]
t <- t[-(83:84),]
t <- t[-(146:147),]
t <- t[-(249:250),]
t$Total <- gsub(' ','',t$Total)
t$Total <- as.numeric(t$Total)
rm(webpage)
t$Densidad <- as.numeric(t$Densidad)
t$Superficie <- gsub(' ','',t$Superficie)
t$Superficie <- as.numeric(t$Superficie)
sum(t$Total)
tf <- filter(t, ESTADO=="Cojedes")
map_tf <- filter(map,ESTADO=="Cojedes")
zn <- filter(map, ESTADO == "Zona en Reclamación" )
zn <- zn |>
mutate(N=1,
Capital="zn",
Total=NA,
Capital=0,
Cap=0,
Superficie=0,
Densidad=0)
t$MUNICIPIO <- gsub("José Félix ", "", t$MUNICIPIO)
t$MUNICIPIO <- gsub("Ribas", "José Félix Ribas", t$MUNICIPIO)
map <- read_sf('Municipios_Venezuela.shp')
map$MUNICIPIO <- gsub("Autónomo ", "", map$MUNICIPIO)
map$MUNICIPIO <- gsub("EL Hatillo", "El Hatillo", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Fernando de Peñalver", "Peñalver", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Tocopero", "Tocópero", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Panamericanp", "Panamericano", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Francisco del Carmen Carvajal", "Carvajal", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Guasimos", "Guásimos", map$MUNICIPIO)
map$MUNICIPIO <- gsub("San José de Guanipa", "Guanipa", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Jimenez", "Jiménez", map$MUNICIPIO)
map$MUNICIPIO <- gsub("José Gregorio Monagas", "Monagas", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Sir Arthur Mac Gregor", "McGregor", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Juan Vicente Campo Elías", "Juan Vicente Campos Elías", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Diego Bautista Urbanejo", "Lic. Diego Bautista Urbaneja", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Julián Mellado", "Mellado", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Pedro María Freites", "Freites", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Jesús María Semprum", "Jesús María Semprún", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Heres", "Angostura del Orinoco", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Raúl Leoni", "Angostura", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Juan Germán Roscio", "Roscio", map$MUNICIPIO)
map$MUNICIPIO <- gsub("José Tadeo Monagas", "Monagas",map$MUNICIPIO)
map$MUNICIPIO <- gsub("Sir Arthur Mac Gregor", "McGregor",map$MUNICIPIO)
tt1 <- map %>%
filter(ESTADO == "Anzoátegui") %>%
filter(MUNICIPIO == "Simón Bolívar") %>%
mutate(MUNICIPIO = replace(MUNICIPIO, MUNICIPIO =="Simón Bolívar" ,"Bolívar" )) %>%
mutate(N=0) %>%
mutate(Capital=0) %>%
mutate(Cap=0) %>%
mutate(Superficie=0) %>%
mutate(Densidad=0) %>%
mutate(Total=50000)
tt2 <- map %>%
filter(ESTADO == "Cojedes") %>%
filter(MUNICIPIO == "Falcón") %>%
mutate(MUNICIPIO = replace(MUNICIPIO, MUNICIPIO =="Falcón" ,"Tinaquillo" )) %>%
mutate(N=0) %>%
mutate(Capital=0) %>%
mutate(Cap=0) %>%
mutate(Superficie=0) %>%
mutate(Densidad=0) %>%
mutate(Total=125000)
map$MUNICIPIO <- gsub("Ortíz", "Ortiz", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Leonardo Infante", "Infante", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Las Mercedes", "Juan José Rondón", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Manuel Ezequiel Bruzual", "Bruzual", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Juan Manuel Cajigal", "Cajigal", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Juan Antonio Sotillo", "Sotillo", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Juan Germán Roscio", "Roscio", map$MUNICIPIO)
map$MUNICIPIO <- gsub("Julián Mellado", "Mellado", map$MUNICIPIO)
t$MUNICIPIO <- gsub("Guajira","Páez", t$MUNICIPIO)
t$MUNICIPIO <- gsub("Capacho Nuevo","Independencia", t$MUNICIPIO)
t$MUNICIPIO <- gsub("Capacho Viejo","Libertad", t$MUNICIPIO)
t$MUNICIPIO <- gsub("Francisco de Miranda", "Miranda", t$MUNICIPIO)
t$MUNICIPIO <- gsub("Tinaquillo", "San Carlos", t$MUNICIPIO)
map$MUNICIPIO <- gsub("Francisco de Miranda", "Miranda", map$MUNICIPIO)
#tf$MUNICIPIO <- gsub("Ortiz", "Ortíz", tf$MUNICIPIO)
#t$MUNICIPIO <- gsub("Angostura del Orinoco", "Angostura", t$MUNICIPIO)
t$ESTADO <- gsub("La Guaira", "Vargas", t$ESTADO)
# SHAPE
l1 <- map_tf$MUNICIPIO
# WEB SCRAPING
l2 <- tf$MUNICIPIO
setdiff(l1, l2)
setdiff(l2, l1)
# MERGE
mm <- merge(x = t, y = map)
mm <- rbind(mm, zn, tt1, tt2)
data_sf <- mm %>%
st_as_sf()
#paleta = RColorBrewer::brewer.pal(5, "YlGnBu")
paleta = RColorBrewer::brewer.pal(5, "Blues")
bubble_sizes <- c(1,1,1,1,1)
bubble_sizes2 <- c(2)
y <- c(10.460538, 10.639299, 10.1488112, 10.1723511,8.3015743)
x <- c(-66.9937251, -71.6687147, -69.4930325, -68.004371,-62.7434246)
geocode <- data.frame(x,y)
geocode2 <- st_as_sf(geocode, coords = c("x", "y"), crs = 4326)
punto <- "Most populated municipalities"
############
paleta = RColorBrewer::brewer.pal(9, "Blues")
mapa <- tm_shape(data_sf)+
tm_fill(col = "Total", palette = paleta,
style = "kmeans", colorNA = "snow3", title = "Population",
n = 9) +
tm_borders("grey40", lwd = 0.1)
mapa
mapa <- tm_shape(data_sf)+
tm_fill(col = "Total", palette = paleta,
style = "kmeans", colorNA = "snow3", title = "Population",
n=9) +
tm_borders("grey40", lwd = 0.2)+
#tm_graticules(col="grey90")+
tm_scale_bar(position = c("left", "bottom"))+
tm_layout(main.title = "    Population of Venezuela",
title.size=4.5,
#main.title.position = "CENTER",
title.position = c('right', 'top')) +
#tm_shape(geocode2) +      # dots shape
#tm_dots(col = "red", size = .05, shapeNA = NA) +
tm_add_legend('symbol',
col = head(rev(RColorBrewer::brewer.pal(9, "Blues") ),5 ),
border.col = "grey40",
size = bubble_sizes,
labels = c('1: Libertador, Distrito Capital',
'2: Maracaibo, Zulia','3: Iribarren, Lara',
'4: Valencia, Carabobo',
"5: Caroní, Bolívar"),
title=punto) +
tm_credits("Data: INE (03/07/2022)\n@programandoenR",
position=c("left", "bottom"))
mapa
A <- ggplot(data = data_sf) +
ggtitle("Україна - Відсоток російськомовних") +
xlab("") +
ylab("") +
geom_sf(aes(fill=Total), show.legend = T, size = 0.05) +
scale_fill_viridis_c(alpha = .6) +
#geom_sf_text(aes(label =Ucraniano),size=3,family="sans")+
# geom_label(aes(fill = Ucraniano), colour = "white", fontface = "bold") +
#theme_void() +
theme(plot.title = element_text(size = 16),
plot.subtitle = element_text(size = 20)) +
labs(fill= "Відсоток")
A
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
knitr::write_bib(x = c("knitr", "rmarkdown") , file = "referencias.bib")
library(readxl)
note <- read_excel("note.xlsx")
ma <- source("ma.R")
df <- source("code.R")
setwd("~/Documents/fv/TidyTuesday/tidytuesday")
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
knitr::write_bib(x = c("knitr", "rmarkdown") , file = "referencias.bib")
knitr::include_graphics("rmarkdown.png")
library(readxl)
note <- read_excel("note.xlsx")
ma <- source("ma.R")
df <- source("code.R")
remotes::install_github("wmgeolab/rgeoboundaries")
setwd("~/Documents/fv")
library(tidyverse)
library(showtext)
library(camcorder)
library(ggtext)
library(glue)
tuesdata <- tidytuesdayR::tt_load("2025-05-06")
nsf_terminations <- tuesdata$nsf_terminations
curved_arrow <- function(x_start, x_end, y_start, y_end, ...) {
annotate(
geom = "curve",
x = x_start,
xend = x_end,
y = y_start,
yend = y_end,
linewidth = 0.3,
color = text_col,
arrow = arrow(
length = unit(1.5, "mm"), type = "closed"
),
...
)
}
font_add_google("Montserrat")
showtext_auto()
showtext_opts(dpi = 300)
bg_col <- "#d6cac8"
text_col <- "#3D0D00"
highlight_col <- "#c72b00"
null_col <- "grey30"
body_font <- "Montserrat"
title_font <- "Montserrat"
plot_data <- nsf_terminations |>
filter(termination_letter_date == ymd("20250425")) |>
select(in_cruz_list, nsf_startdate, termination_letter_date, nsf_expected_end_date) |>
mutate(
days_lost = nsf_expected_end_date - termination_letter_date,
days_done = termination_letter_date - nsf_startdate
) |>
arrange(desc(days_lost), days_done) |>
mutate(id = factor(row_number())) |>
mutate(
days_done = as.numeric(days_done, unit = "days"),
days_lost = as.numeric(days_lost, unit = "days")
)
tot_days_lost <- plot_data |>
filter(days_lost > 0) |>
pull(days_lost) |>
sum()
cruz <- plot_data |>
filter(in_cruz_list) |>
nrow()
title <- glue("{format(tot_days_lost, big.mark = ',')} days of research terminated in a single day")
st <- glue("On 25 April 2025, a total of {nrow(plot_data)} National Science Foundation grants were terminated under the Trump Administration, resulting in an expected loss of funding for {format(tot_days_lost, big.mark = ',')} days of research, on topics including flood protection, mathematics education, race in the criminal justice system, and mentorship of women in international relations. Of those grants, {cruz} were included on Ted Cruz's <span style='color:{highlight_col}'>**list of projects which he claimed *promoted Diversity, Equity, and Inclusion (DEI) or advanced neo-Marxist class warfare propaganda*.**</span>")
cap <- paste0(
"**Data**: Grant Watch | **Graphic**:", social
)
ggplot(
data = plot_data
) +
geom_tile(
mapping = aes(
x = id,
y = termination_letter_date - (days_done / 2),
height = -days_done,
width = 1,
fill = in_cruz_list
),
alpha = 0.4,
linewidth = 0,
colour = NA
) +
geom_tile(
mapping = aes(
x = id,
y = termination_letter_date + (days_lost / 2),
height = days_lost,
width = 1,
fill = in_cruz_list
),
alpha = 1,
linewidth = 0,
colour = NA
) +
annotate("text",
x = "500", y = ymd("20261001"),
family = body_font,
label = str_wrap("Research days terminated", 12),
lineheight = 1
) +
curved_arrow("460", "400",
ymd("20261001"), ymd("20260901"),
curvature = 0.5) +
annotate("text",
x = "70", y = ymd("20211001"),
family = body_font,
label = str_wrap("Research days already carried out", 12),
lineheight = 1
) +
curved_arrow("120", "180",
ymd("20211001"), ymd("20211101"),
curvature = 0.5) +
scale_y_date() +
scale_fill_manual(values = c(null_col, highlight_col)) +
coord_cartesian(expand = FALSE) +
labs(
title = title,
subtitle = st,
caption = cap
) +
theme_void(base_family = body_font, base_size = 9) +
theme(
axis.text.y = element_text(margin = margin(r = 5)),
plot.margin = margin(5, 5, 5, 5),
legend.position = "none",
plot.title.position = "plot",
plot.caption.position = "plot",
plot.background = element_rect(fill = bg_col, colour = bg_col),
panel.background = element_rect(fill = bg_col, colour = bg_col),
plot.title = element_textbox_simple(
colour = text_col,
hjust = 1,
halign = 1,
margin = margin(b = 5, t = 5),
lineheight = 0.5,
family = title_font,
face = "bold",
size = rel(1.8)
),
plot.subtitle = element_textbox_simple(
colour = text_col,
hjust = 1,
halign = 1,
margin = margin(b = -75, t = 5),
maxwidth = 0.8,
family = body_font
),
plot.caption = element_textbox_simple(
colour = text_col,
hjust = 0,
halign = 0,
margin = margin(b = 0, t = 10),
lineheight = 0.5,
family = body_font
),
strip.text = element_blank(),
panel.spacing = unit(0, "lines")
)
title <- glue("{format(tot_days_lost, big.mark = ',')}  Los días de investigación terminaron en un solo día.")
st <- glue("El 25 de abril de 2025, un total de {nrow(plot_data)} subvenciones de la Fundación Nacional para la Ciencia fueron canceladas bajo la administración Trump., resulting in an expected loss of funding for {format(tot_days_lost, big.mark = ',')} days of research, on topics including flood protection, mathematics education, race in the criminal justice system, and mentorship of women in international relations. Of those grants, {cruz} were included on Ted Cruz's <span style='color:{highlight_col}'>**list of projects which he claimed *promoted Diversity, Equity, and Inclusion (DEI) or advanced neo-Marxist class warfare propaganda*.**</span>")
cap <- paste0(
"**Data**: Grant Watch | **Graphic**:", social
)
ggplot(
data = plot_data
) +
geom_tile(
mapping = aes(
x = id,
y = termination_letter_date - (days_done / 2),
height = -days_done,
width = 1,
fill = in_cruz_list
),
alpha = 0.4,
linewidth = 0,
colour = NA
) +
geom_tile(
mapping = aes(
x = id,
y = termination_letter_date + (days_lost / 2),
height = days_lost,
width = 1,
fill = in_cruz_list
),
alpha = 1,
linewidth = 0,
colour = NA
) +
annotate("text",
x = "500", y = ymd("20261001"),
family = body_font,
label = str_wrap("Research days terminated", 12),
lineheight = 1
) +
curved_arrow("460", "400",
ymd("20261001"), ymd("20260901"),
curvature = 0.5) +
annotate("text",
x = "70", y = ymd("20211001"),
family = body_font,
label = str_wrap("Research days already carried out", 12),
lineheight = 1
) +
curved_arrow("120", "180",
ymd("20211001"), ymd("20211101"),
curvature = 0.5) +
scale_y_date() +
scale_fill_manual(values = c(null_col, highlight_col)) +
coord_cartesian(expand = FALSE) +
labs(
title = title,
subtitle = st,
caption = cap
) +
theme_void(base_family = body_font, base_size = 9) +
theme(
axis.text.y = element_text(margin = margin(r = 5)),
plot.margin = margin(5, 5, 5, 5),
legend.position = "none",
plot.title.position = "plot",
plot.caption.position = "plot",
plot.background = element_rect(fill = bg_col, colour = bg_col),
panel.background = element_rect(fill = bg_col, colour = bg_col),
plot.title = element_textbox_simple(
colour = text_col,
hjust = 1,
halign = 1,
margin = margin(b = 5, t = 5),
lineheight = 0.5,
family = title_font,
face = "bold",
size = rel(1.8)
),
plot.subtitle = element_textbox_simple(
colour = text_col,
hjust = 1,
halign = 1,
margin = margin(b = -75, t = 5),
maxwidth = 0.8,
family = body_font
),
plot.caption = element_textbox_simple(
colour = text_col,
hjust = 0,
halign = 0,
margin = margin(b = 0, t = 10),
lineheight = 0.5,
family = body_font
),
strip.text = element_blank(),
panel.spacing = unit(0, "lines")
)
title <- glue("{format(tot_days_lost, big.mark = ',')}  Los días de investigación terminaron en un solo día.")
st <- glue("El 25 de abril de 2025, un total de {nrow(plot_data)} subvenciones de la Fundación Nacional para la Ciencia fueron canceladas bajo la administración Trump., resulting in an expected loss of funding for {format(tot_days_lost, big.mark = ',')} days of research, on topics including flood protection, mathematics education, race in the criminal justice system, and mentorship of women in international relations. Of those grants, {cruz} were included on Ted Cruz's <span style='color:{highlight_col}'>**list of projects which he claimed *promoted Diversity, Equity, and Inclusion (DEI) or advanced neo-Marxist class warfare propaganda*.**</span>")
cap <- paste0(
"**Data**: Grant Watch | **Graphic**:", social
)
ggplot(
data = plot_data
) +
geom_tile(
mapping = aes(
x = id,
y = termination_letter_date - (days_done / 2),
height = -days_done,
width = 1,
fill = in_cruz_list
),
alpha = 0.4,
linewidth = 0,
colour = NA
) +
geom_tile(
mapping = aes(
x = id,
y = termination_letter_date + (days_lost / 2),
height = days_lost,
width = 1,
fill = in_cruz_list
),
alpha = 1,
linewidth = 0,
colour = NA
) +
annotate("text",
x = "500", y = ymd("20261001"),
family = body_font,
label = str_wrap("Días de investigación finalizados", 12),
lineheight = 1
) +
curved_arrow("460", "400",
ymd("20261001"), ymd("20260901"),
curvature = 0.5) +
annotate("text",
x = "70", y = ymd("20211001"),
family = body_font,
label = str_wrap("Días de investigación ya realizados", 12),
lineheight = 1
) +
curved_arrow("120", "180",
ymd("20211001"), ymd("20211101"),
curvature = 0.5) +
scale_y_date() +
scale_fill_manual(values = c(null_col, highlight_col)) +
coord_cartesian(expand = FALSE) +
labs(
title = title,
subtitle = st,
caption = cap
) +
theme_void(base_family = body_font, base_size = 9) +
theme(
axis.text.y = element_text(margin = margin(r = 5)),
plot.margin = margin(5, 5, 5, 5),
legend.position = "none",
plot.title.position = "plot",
plot.caption.position = "plot",
plot.background = element_rect(fill = bg_col, colour = bg_col),
panel.background = element_rect(fill = bg_col, colour = bg_col),
plot.title = element_textbox_simple(
colour = text_col,
hjust = 1,
halign = 1,
margin = margin(b = 5, t = 5),
lineheight = 0.5,
family = title_font,
face = "bold",
size = rel(1.8)
),
plot.subtitle = element_textbox_simple(
colour = text_col,
hjust = 1,
halign = 1,
margin = margin(b = -75, t = 5),
maxwidth = 0.8,
family = body_font
),
plot.caption = element_textbox_simple(
colour = text_col,
hjust = 0,
halign = 0,
margin = margin(b = 0, t = 10),
lineheight = 0.5,
family = body_font
),
strip.text = element_blank(),
panel.spacing = unit(0, "lines")
)
cruz
